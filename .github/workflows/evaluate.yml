name: Offline Evaluation

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  evaluate:
    runs-on: ubuntu-latest
    container: python:3.13-slim

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install evaluation dependencies
      run: |
        python -m pip install --upgrade pip
        pip install polars numpy pyarrow requests kaggle

    - name: Download ground truth data
      env:
        KAGGLE_USERNAME: ${{ secrets.KAGGLE_USERNAME }}
        KAGGLE_KEY: ${{ secrets.KAGGLE_KEY }}
      run: |
        apt-get update && apt-get install -y unzip
        mkdir -p data
        kaggle competitions download -c ts-forecasting
        unzip -o ts-forecasting.zip -d data/
        rm ts-forecasting.zip

    - name: Run Evaluation
      run: |
        # Check if submission file exists
        if [ -f "submission_final_polars.csv" ]; then
          python evaluate.py
        else
          echo "Skipping evaluation: submission_final_polars.csv not found."
        fi
